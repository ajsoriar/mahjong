<html>

<head>
	<style type="text/css">

	body {
		margin: 0px;
		padding: 0px;
	}

	#mainContainer{
		width: 100%;
		height: 100%;
		background-color: #ccc;
	}

	#levelPicture{
		width: 80%;
		height: 80%;
		background-color: #ddd;
		border: 1px solid red;
		position: absolute;
		overflow: hidden;
	}

	.ficha{
		width: 100px;
		height: 75px;
		background-color: #eee;
		display: block;	

		border-top: 1px solid #fff;
		border-right: 2px solid #CCCCCC;
		border-bottom: 4px solid #ddd;
		border-left: 1px solid #ddd;

		box-shadow: 1px 2px 6px rgba(0, 0, 0, 0.5);
		border-radius: 3px;

		position: absolute;
	}

	.ficha:hover{
		box-shadow: 1px 1px 3px rgba(255, 0, 0, 0.8);
		border-color: red;
	}

	</style>

</head>


<body>

	<div id="mainContainer">
		<div id="levelPicture"></div>
		<div id="piecesContainer"></div>
	</div>

<script type="text/javascript">

	var pi_ejepcio = 3.16;
	var pi_griego = 3.14;
	var $ = document.getElementById;

	//document.getElementById("mainContainer").innerHTML = "fuck!";

	console.log("fuking javascript!");	

	ficha = function (){

		createID = function(){
			var timestamp = new Date().getTime();
			var randomNumber = Math.ceil(Math.random()*100000);
			return type + "_" + timestamp + "_" + randomNumber;	
		}
		
		var type = "ficha";
		var ID = createID();
		var el = null;

		// Funcion privada
		var ficha = function(){
			console.log("inicializade objeto ", ID);
			drawTemplate();
			el = document.getElementById(ID);
			//console.log("this.el",el);
		}
		
		// Funcion privada
		//this.render = function(where){
		drawTemplate = function(){
			//console.log("dibuja!");	
			document.write('<div id="'+ ID +'" class="ficha" style="top:0px;left:0px;display:none">'+ ID +'</div>');
		}

		/*
		this.giveMeTheTemplate = function(){
			return '<div id="'+ ID +'" class="ficha" style="top:0px;left:0px;display:none">'+ ID +'</div>';
		}
		*/

		this.oculta = function(){
			//console.log("oculta!");	
		}

		this.getName = function(){};

		this.getType = function(){
			return type;
		};

		this.show = function (){
			//console.log("show");
			el.style.display = null;
		};

		this.setPosition = function(x,y){
			el.style.top = y+"px";
			el.style.left = x+"px";
		};

		ficha();

	} 

	var redrawAll = function(){

		//console.log("Redraw!");
		win_w = window.innerWidth;
		win_h = window.innerHeight;

		// relocate background picture.
		var obj = document.getElementById("levelPicture");
		console.log("obj.style.width/2:",obj.clientWidth);
		var x = (win_w/2) - (obj.clientWidth/2);
		var y = (win_h/2) - (obj.clientHeight/2);
		obj.style.top = y+"px";
		obj.style.left = x+"px";

		// paint the pieces


		console.log("scnarioWidth:",scnarioWidth);
		console.log("scnarioHeight:",scnarioHeight);
		var desp_x = (win_w/2)-(scnarioWidth/2);
		var desp_y = (win_h/2)-(scnarioHeight/2);


		var lon = fichasEnJuego.length;
		for (var i = 0; i < lon; i++){
			var x=escenario1.positions[i].x * 100 + desp_x;
			var y=escenario1.positions[i].y * 75 + desp_y; 
			fichasEnJuego[i].setPosition(x,y);
		}



		relocateFichas();
	}

	window.onresize = function(event) {
	    console.log("width:",window.innerWidth,", height:", window.innerHeight);
	    redrawAll();
	}

	var escenario1 = {
		type: "scenary",
		name: "scenary number one",
		bgPicture: "flowers.jpg",
		/*
		positions: [
			{piso1:[{x:0,y:0,},{x:0,y:1},{x:0,y:2},{x:1,y:2},{x:2,y:2}]},
			{piso2:[{x:0,y:0,},{x:0,y:1},{x:0,y:2},{x:1,y:2},{x:2,y:2}]},
			{piso3:[{x:0,y:0,},{x:0,y:1},{x:0,y:2},{x:1,y:2},{x:2,y:2}]},
			{piso4:[{x:0,y:0,},{x:0,y:1},{x:0,y:2},{x:1,y:2},{x:2,y:2}]},
		]
		*/
		positions: [{x:0,y:0,},{x:0,y:1},{x:0,y:2},{x:1,y:2},{x:2,y:2}]
	};

	var fichasEnJuego=[];

	var scnarioWidth = null;
	var scnarioHeight = null;

	var createScenario = function(){ // Here the pieces are created, we create new objects

		var pieces_width = 0;
		var pieces_height = 0;

		var lon = escenario1.positions.length;
		for (var i=0; i<lon; i++){
			fichasEnJuego[i] = new ficha;
			var x=escenario1.positions[i].x * 100;
			var y=escenario1.positions[i].y * 75; 
			fichasEnJuego[i].setPosition(x,y);
			fichasEnJuego[i].show();

			if (pieces_width < x) pieces_width = x;
			if (pieces_height < y) pieces_height = y;
		}

		scnarioWidth = pieces_width + 100;
		scnarioHeight = pieces_height + 75;

	}

	var relocateFichas = function(){ // here we relocate the pieces upon the scenary, we dont create objects
		
		// This works!

		/*
		var lon = fichasEnJuego.length;
		var where = document.getElementById("piecesContainer");

		for (var i = 0; i < lon; i++){
			//fichasEnJuego[i].render(where);
			var x=escenario1.positions[i].x * 100;
			var y=escenario1.positions[i].y * 75; 
			fichasEnJuego[i].setPosition(x,y);
			
		}
		*/
		
		/*
		var lon = fichasEnJuego.length;
		var trozo = null;

		for (var i = 0; i < lon; i++){
			var x=escenario1.positions[i].x * 100;
			var y=escenario1.positions[i].y * 75; 
			fichasEnJuego[i].setPosition(x,y);
			trozo = trozo + fichasEnJuego[i].giveMeTheTemplate();
		}

		var where = document.getElementById("piecesContainer");
		where.innerHTML = trozo;
		*/

	}

	createScenario();
	redrawAll();

</script>

</body>
</html>